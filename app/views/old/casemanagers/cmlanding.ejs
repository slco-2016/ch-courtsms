<% include ../partials/headers/header-base %>

<!-- Include Case Manager Landing View specific styling -->
<link rel="stylesheet" type="text/css" href="/static/css/cmlanding.css">

<% var thisUsersCount = 0; %>
<% var topUsersCount = 1; %>
<% var topUser = {}; %>

<% for (var i = 0; i < counts.length; i++) { %>
<%  var c = counts[i]; %>
<%  var ct = Number(c.count); %>
<%  if (ct > topUsersCount) { %>
<%    topUsersCount = ct; %>
<%    topUser = c; %>
<%  }; %>
<%  if (Number(c.cmid) == Number(user.cmid)) thisUsersCount = ct; %>
<% } %>

<% var ctRatio = Math.round((thisUsersCount/topUsersCount) * 1000)/10; %>

<!-- Additional libraries, loaded via CDN -->
<!-- TO DO: If we are sticking with C3js, then let's NPM install (or Bower) -->
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css">


<div class="contents">
    
  <% if (typeof user !== "undefined" && ([33].indexOf(user.cmid) > -1)) { %>
    <a href="/v4">
      <div class="captureBoard" style="color: #2fc3e8; background-color: #344289; height: 30px; line-height: 30px; text-align: center; font-size: 18px; font-weight: 700; padding-bottom: 20px;">
          <span style="padding: 10px 20px 10px 20px; background-color: rgba(0, 0, 0, 0.25); border-radius: 10px;">
            Proceed to ClientComm Version 4.0! Thanks for participating in the Beta.
          </span>
        </div>
    </a>
  <% } %>

  <% if (showCaptureBoard) { %>
  <div class="captureBoard">
    <a href="/capture">
      <div class="icon">
        <svg width="67px" height="70px" viewBox="704 338 67 86" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="checklist" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(704.000000, 339.000000)">
            <path d="M8.19745604,16.3945385 C7.43525824,16.3945385 6.67306044,16.1031099 6.0902033,15.5202527 L0.874379121,10.3044286 C-0.291335165,9.13871429 -0.291335165,7.25563736 0.874379121,6.08992308 C2.03262088,4.92420879 3.92317033,4.92420879 5.08141209,6.08992308 L8.19745604,9.20596703 L16.5293242,0.874098901 C17.6875659,-0.291615385 19.5706429,-0.291615385 20.7363571,0.874098901 C21.9020714,2.03234066 21.9020714,3.92289011 20.7363571,5.0886044 L10.2972363,15.5202527 C9.72185165,16.1031099 8.95965385,16.3945385 8.19745604,16.3945385" id="Fill-1" fill="#FEFEFE"></path>
            <path d="M63.0435659,11.1755385 L31.5842253,11.1755385 C29.9402692,11.1755385 28.6026868,9.83795604 28.6026868,8.194 C28.6026868,6.55004396 29.9402692,5.21993407 31.5842253,5.21993407 L63.0435659,5.21993407 C64.687522,5.21993407 66.0251044,6.55004396 66.0251044,8.194 C66.0176319,9.84542857 64.687522,11.1755385 63.0435659,11.1755385" id="Fill-3" fill="#FEFEFE"></path>
            <path d="M8.19745604,61.6383571 C7.43525824,61.6383571 6.67306044,61.3469286 6.0902033,60.7640714 L0.874379121,55.5482473 C-0.291335165,54.382533 -0.291335165,52.499456 0.874379121,51.3337418 C2.03262088,50.1680275 3.92317033,50.1755 5.08141209,51.3337418 L8.19745604,54.4497857 L16.5293242,46.1179176 C17.6875659,44.9522033 19.5706429,44.9522033 20.7363571,46.1179176 C21.9020714,47.2761593 21.9020714,49.1667088 20.7363571,50.3249505 L10.2972363,60.7640714 C9.72185165,61.3469286 8.95965385,61.6383571 8.19745604,61.6383571" id="Fill-5" fill="#FEFEFE"></path>
            <path d="M31.5842253,56.419544 C29.9402692,56.419544 28.6026868,55.0819615 28.6026868,53.4380055 C28.6026868,51.7940495 29.9402692,50.4639396 31.5842253,50.4639396 L63.0435659,50.4639396 C64.687522,50.4639396 66.0251044,51.7940495 66.0251044,53.4380055 C66.0251044,55.0819615 64.687522,56.419544 63.0435659,56.419544 L31.5842253,56.419544 Z" id="Fill-7" fill="#FEFEFE"></path>
            <path d="M8.19745604,84.2590989 C7.43525824,84.2590989 6.67306044,83.9676703 6.0902033,83.3848132 L0.874379121,78.168989 C-0.291335165,77.0032747 -0.291335165,75.1201978 0.874379121,73.9544835 C2.04009341,72.7887692 3.92317033,72.7887692 5.08141209,73.9544835 L8.19745604,77.0705275 L16.5293242,68.7386593 C17.6950385,67.5729451 19.5781154,67.5729451 20.7363571,68.7386593 C21.9020714,69.9043736 21.9020714,71.7874505 20.7363571,72.9531648 L10.3047088,83.3848132 C9.72185165,83.9676703 8.95965385,84.2590989 8.19745604,84.2590989" id="Fill-9" fill="#FEFEFE"></path>
            <path d="M63.0435659,79.041033 L31.5842253,79.041033 C29.9402692,79.041033 28.6026868,77.7034505 28.6026868,76.0594945 C28.6026868,74.4155385 29.9402692,73.0854286 31.5842253,73.0854286 L63.0435659,73.0854286 C64.687522,73.0854286 66.0251044,74.4155385 66.0251044,76.0594945 C66.0251044,77.7034505 64.687522,79.041033 63.0435659,79.041033" id="Fill-11" fill="#FEFEFE"></path>
            <path d="M8.19745604,39.0166813 C7.43525824,39.0166813 6.67306044,38.7252527 6.0902033,38.1423956 L0.874379121,32.9265714 C-0.291335165,31.7608571 -0.291335165,29.8777802 0.874379121,28.7120659 C2.03262088,27.5463516 3.92317033,27.5463516 5.08141209,28.7120659 L8.19745604,31.8281099 L16.5293242,23.4962418 C17.6875659,22.3305275 19.5706429,22.3305275 20.7363571,23.4962418 C21.9020714,24.6544835 21.9020714,26.545033 20.7363571,27.7107473 L10.2972363,38.1423956 C9.72185165,38.7252527 8.95965385,39.0166813 8.19745604,39.0166813" id="Fill-13" fill="#FEFEFE"></path>
            <path d="M63.0435659,33.7988022 L31.5842253,33.7988022 C29.9402692,33.7988022 28.6026868,32.4612198 28.6026868,30.8172637 C28.6026868,29.1733077 29.9402692,27.8431978 31.5842253,27.8431978 L63.0435659,27.8431978 C64.687522,27.8431978 66.0251044,29.1733077 66.0251044,30.8172637 C66.0176319,32.4612198 64.687522,33.7988022 63.0435659,33.7988022" id="Fill-15" fill="#FEFEFE"></path>
          </g>
        </svg>
      </div>
      <div class="body">
        There are new, unclaimed messages. Click to view capture board now.
      </div>
    </a>
  </div>
  <% } %>

  <div class="top">
    <div class="left">
      <div class="head">
        Welcome, <%= user.first %>!
      </div>
      <div class="body">
        <% if (topUser.cmid == user.cmid) { %>
          Congrats! You are the top user so far this week!
        <% } else { %>
          You are 
          <span class="gold">
            <%= ctRatio %>%
          </span> 
          of the way to being the top user this week. 
        <% } %>
      </div>
    </div>
    <div class="right">
      <div id="gaugechart"></div>
    </div>
  </div>


  <div class="middle">
    <div class="left" style="margin-right: auto; margin-left: auto; float: none;">
      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>/cls">
          <div class="bigcircles blue">
            <svg width="88px" height="88px" viewBox="242 338 88 88" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <path d="M290,377 L290,338 L282,338 L282,377 L242,377 L242,385 L282,385 L282,426 L290,426 L290,385 L330,385 L330,377 L290,377 Z" id="Combined-Shape" stroke="none" fill="#FFFFFF" fill-rule="evenodd"></path>
            </svg>
          </div>
          <div class="subtitle">
            <a href="/cms/<%= user.cmid %>/cls">Add New Client</a>
          </div>
        </a>
      </div>

      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>">
          <div class="bigcircles darkblue">
            <svg width="83px" height="102px" viewBox="470 340 83 102" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <path d="M553,425.579796 C550.755511,408.395404 538.45281,394.033259 521.573855,389.769549 C534.471024,384.038139 540.367954,368.736339 534.742734,355.592632 C529.117513,342.447285 514.104299,336.438733 501.207131,342.171784 C488.311608,347.903194 482.414678,363.204994 488.039898,376.348701 C490.61044,382.355613 495.313493,387.150647 501.207131,389.769549 C484.45662,394.092295 472.267544,408.365886 470,425.432206 C480.842053,435.688069 495.479813,442 511.57822,442 C527.59923,442 542.172767,435.748745 553,425.579796" id="Fill-1" stroke="none" fill="#FFFFFF" fill-rule="evenodd"></path>
            </svg>
          </div>
          <div class="subtitle">
            Client Directory
          </div>
        </a>
      </div>
    </div>
  </div>

  <style>
    .rowtwo .optionBlock {
      width: 148px !important;
    }
    .rowtwo .subtitle {
      background-color: #FFF;
      padding: 5px !important;
      text-align: center;
      vertical-align: top;
      border-radius: 6px;
      width: 100px;
      margin: 0px !important;
    }

    .rowtwo .subtitle:hover {
      background-color: #2F8CE8;
      color: #FFF;
    }

    .middle.rowtwo {
      height: 200px;
      overflow-y: hidden;
    }

  </style>

  <div class="middle rowtwo">
    <div class="right">

      <div class="notice">
        <b>New Feature!</b>
        Type less by using templates.
      </div>

      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>/templates/create">
          <div class="subtitle">
            Create Template
          </div>
        </a>
      </div>

      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>/templates">
          <div class="subtitle">
            Manage Templates
          </div>
        </a>
      </div>
    </div>

    <div class="right" style="border-left: 1px solid #898989; width: 349px">
      <div class="notice">
        <b>New Feature!</b>
        Send messages at a future date.
      </div>

      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>/notifications/new">
          <div class="subtitle">
            Create Notification
          </div>
        </a>
      </div>

      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>/notifications">
          <div class="subtitle">
            Manage Notifications
          </div>
        </a>
      </div>
    </div>
  </div>

  <div class="middle rowtwo">
    <div class="right" style="border-right: 1px solid #898989; ">

      <div class="notice">
        <b>New Feature!</b>
        Send a message to multiple clients.
      </div>

      <div class="optionBlock">
        <a href="/cms/<%= user.cmid %>/templates/create">
          <div class="subtitle">
            Create Group Message
          </div>
        </a>
      </div>
    </div>
  </div>

  <div style="padding: 50px; color: #558cc9">
    ClientComm is a work in progress - and you make it possible.
    <a href="http://c4a-slc.tumblr.com/" style="cursor: pointer">
      <b>Follow along via our blog.</b>
    </a>
  </div>

  <div class="bottom">
    <% include ../../public/icons/logo.svg %>
    <% include ../../public/icons/logotext.svg %>

    <div class="number">
      <i class="fa fa-mobile" ></i> 
      text (385) 206-6352
    </div>
  </div>


</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>

<script type="text/javascript">
  c3.generate({
      data: {
        columns: [ ["Proportion of Peak", <%= ctRatio %>] ],
        type: "gauge",
      },
      color: {
        pattern: ["#f67d02", "#f6bb02", "#e8f602", "#92f602"], // Color levels for the percentage values
        threshold: { values: [30, 60, 90, 100] }
      },
      size: { height: 120, width: 200 },
      bindto: "#gaugechart"
  });
</script>


<% include ../partials/footers/footer %>
