<% let currentTime = moment(); %>
<% include ../partials/hubFrameTop %>

<link rel="stylesheet" type="text/css" href="/static/css/captureboard.css">

<% if (conversations.length == 0) { %><% include ../partials/emptyResultsGreeting %><% } %>

<% conversations.forEach(function (convo) { %>
  <div class="convoBlock">

    <div class="actionBox">
      
      <a href="/captured/attach/<%= convo.convo %>">
        <div class="claimButton">
          <i class="fa fa-user-plus"></i>
          Attach Conversation to Client
        </div>
      </a>
      
      <div class="tinyInfo">
        <div class="blurb">
          <div class="header">
            Last contact
          </div>
          <div class="value">
            <% let timeSince = moment(convo.msgs[convo.msgs.length - 1].created); %>
            sent 
            <%= moment.duration(currentTime.diff(timeSince)).humanize() %>
            ago
          </div>
        </div>
        <div class="blurb">
          <div class="header">
            Conversation length
          </div>
          <div class="value">
            <%= convo.msgs.length %>
            messages long
          </div>
        </div>
      </div>
      
      <div class="tinyInfo">
        <div class="blurb">
          <div class="header">
            Messages from
          </div>
          <div class="value">
            <%= convo.msgs[0].value %>
            (<%= convo.msgs[0].type %>)
          </div>
        </div>
        <div class="blurb">
          <div class="header">
            Messages sent to
          </div>
          <div class="value">
            <%= convo.msgs[0].value %>
            (<%= convo.msgs[0].type %>)
          </div>
        </div>
      </div>

      <div class="closeButton">
        <div class="left">
          <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
          Please be careful! Removing a message is a permanent action.
        </div>
        <div class="right">
          <a href="/captured/remove/<%= convo.convo %>">Delete</a>
        </div>
      </div>
    </div>

    <div class="convoStream">
      <% convo.msgs.forEach(function (ea, i) { %>
        <div class="convoRow">
        
          <div class="msgInbound">
            <% if (ea.inbound) { %>
              <div class="message">
                <%= ea.content %>
              </div>
            <% } %>
          </div>
          <div class="msgOutbound">
            <% if (!ea.inbound) { %>
              <div class="message">
                <%= ea.content %>
              </div>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>

  </div>
<% }) %>

<% include ../partials/hubFrameBottom %>