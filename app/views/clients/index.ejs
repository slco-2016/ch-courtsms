<% include ../partials/hubFrameTop %>

<!-- Load in addition CSS -->
<link rel="stylesheet" type="text/css" href="/static/css/v4_clientsList_supervisor.css">

<div class="header">
  <div class="column">color</div>
  <div class="column">contact</div>
  <div class="column">client name</div>
  <div class="column">case manager</div>
  <div class="column">unread</div>
  <div class="column">transcript</div>
  <div class="column">last activity</div>
  <div class="column">edit</div>
  <div class="column">transfer</div>
  <div class="column">remove</div>
</div>

<% if (clients.length == 0) { %><% include ../partials/emptyResultsGreeting %><% } %>

<% clients.forEach( function (client) { %>
  <% let clientBaseURL = `${level === "org" ? "/org" : ""}/clients/${client.clid}`; %>
  <div class="clientRow" data-client-color="<%= client.color_tag %>">

    <!-- color tag can only be edited if user level -->
    <div class="column" value="<%= client.color_name %>">
      <% if (level === "user") { %>
        <a href="<%=`/clients/${client.clid}/edit/color`%>">
      <% } %>
      <div class="colorTag" style="background-color: <%= client.color_tag %>"></div>
      <% if (level === "user") { %>
        </a>
      <% } %>
    </div>

    <div class="column">
      <% if (client.active) { %>
        <a href="<%=`${clientBaseURL}/address`%>">
          <i class="fa highlight fa-send" aria-hidden="true"></i>
        </a>
      <% } else { %>-<% } %>
    </div>

    <div class="column">
      <a href="<%=`${clientBaseURL}`%>">
        <span class="clientName">
          <%=`${client.last}, ${client.first} ${client.middle}`%>
        </span>
      </a>
    </div>

    <div class="column">
      <% if (level == "org") { %>
        <a href="<%=`/org?user=${client.user_id}`%>"><span class="clientName">
      <% } %>
      <%=`${client.user_last}, ${client.user_first}`%>
      <% if (level == "org") { %>
        </span></a>
      <% } %>
    </div>

    <div class="column">
      <% if (client.unread > 0) { %>
        <span class="bigNumber"><%= client.unread %></span>
      <% } else { %>-<% } %>
    </div>

    <div class="column">
      <!-- Both levels href to same endpoint since it just returns a text download log -->
      <a href="<%= `/clients/${client.clid}/transcript?with=${client.cm}` %>">
        <i class="fa highlight fa-download" aria-hidden="true"></i>
      </a>
    </div>
    
    <div class="column">
      <small>
        <i class="fa fa-clock-o" aria-hidden="true"></i>
        <%= moment.tz(client.updated, local_tz).fromNow() %>
      </small>
    </div>

    <div class="column">
      <a href="<%= `${clientBaseURL}/edit` %>">
        <i class="fa highlight fa-pencil" aria-hidden="true"></i>
      </a>
    </div>

    <div class="column">
      <a href="<%= `${clientBaseURL}/transfer` %>">
        <i class="fa highlight fa-mail-forward" aria-hidden="true"></i>
      </a>
    </div>

    <div class="column">
      <% if (hub.sel === "open") { %>
        <a href="<%= `${clientBaseURL}/alter/close` %>">
          <i class="fa highlight fa-book" aria-hidden="true"></i>
        </a>
      <% } else { %>
        <a href="<%= `${clientBaseURL}/alter/open` %>">
          <i class="fa fa-undo" aria-hidden="true"></i>
        </a>
      <% } %>
    </div>

  </div>
<% }) %>

<script>
  // Manage hover color change for rows
  // To do: Find better solution than a global variable
  var originalBackgroundColor = null;
  $(".clientRow")
    .hover(
      function () {
        var color = $(this).attr("data-client-color");
        originalBackgroundColor = $(this).css("background-color");
        $(this).css("background-color", color);
      }, function () {
        $(this).css("background-color", originalBackgroundColor);
      }
    );
</script>

<% include ../partials/hubFrameBottom %>